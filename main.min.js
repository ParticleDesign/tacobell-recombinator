"use strict";var app={self,numberOfIngredients:0,weightedArray_ingredientCountChances:[{item:1,chance:.02},{item:2,chance:.04},{item:3,chance:.1},{item:4,chance:.21},{item:5,chance:.26},{item:6,chance:.21},{item:7,chance:.1},{item:8,chance:.04},{item:9,chance:.02}],weightedArray_ingredientTypeChances:[{item:"meat",chance:.2},{item:"sauce",chance:.2},{item:"exterior",chance:.1},{item:"topping",chance:.3},{item:"filling",chance:.2}],animationInterval_ingredients:250,animationInterval_banner:300,animationInterval_bannerText:400,animationInterval_bannerTextExpandedPause:150,meal:[],mealName:"",mealHash:"",ingredientsArray:[],sauceArray:[],exteriorArray:[],meatArray:[],toppingArray:[],fillingArray:[],ingredientContainerIDs:[],soundOn:!1,init:function(){self=this,self.fetchIngredientsFromJSON(),$.getJSON("ingredients.json",function(a){self.cacheIngredientArrays(a);var b=window.location.href,c=b.match(/\#[^\]]+/g);if(c){var d=$("div#landing_page"),f=$("div#recombinator_page");d.transition({transform:"translate(-100%)"},0),f.transition({transform:"translate(0%)"},0),self.meal=self.mealModelFromMealPath(c),self.createMealName(),self.displayMealDivs(),self.createMealHash(),self.setSocialMediaLinks(),window.location.hash=""}}),self.armStartButton(),self.armRecombinateButton(),self.armShareButton(),self.armSoundToggle()},cacheIngredientArrays:function(a){a.forEach(function(b){var c=b.type;"sauce"===c?self.sauceArray.push(b):"exterior"===c?self.exteriorArray.push(b):"meat"===c?self.meatArray.push(b):"topping"===c?self.toppingArray.push(b):"filling"===c&&self.fillingArray.push(b),self.ingredientsArray.push(b)})},mealModelFromMealPath:function(a){var a=a.toString().substring(1),b=a.match(/.{1,1}/g),c=[];return b.forEach(function(d){var f=$.grep(self.ingredientsArray,function(g){return g.hash==d})[0];c.push(f)}),$("div#meal_url").html("http://"+window.location.hostname+"/#"+a),console.log("mealPath = "+a),c},armStartButton:function(){var a=$("div#landing_page"),b=$("div#recombinator_page");$("div#title").on("click",function(){console.log("Title clicked!"),a.transition({transform:"translate(-100%)"},500),b.transition({transform:"translate(0%)"},500,function(){self.recombinate(),self.displayMealDivs()});var c=document.getElementById("squish");c.load();var d=document.getElementById("bell");d.load(),ga("send","event","Enter","enter_the_recombinator")}),$("div#sound_on").on("click",function(){console.log("sound on clicked!"),!1==self.soundOn?($("div#sound_on").css("background-position","0px 100%"),$("div#sound_control").css("background-position","0px 0px"),self.soundOn=!0,ga("send","event","Sound","toggle_on")):($("div#sound_on").css("background-position","0px 0px"),$("div#sound_control").css("background-position","-53px 0px"),self.soundOn=!1,ga("send","event","Sound","toggle_off"))}),$("div#header img").on("click",function(){a.transition({transform:"translate(0%)"}),b.transition({transform:"translate(100%)"},500,function(){$("div#recombinator").html(""),$("div#meal_title").css("opacity","0")}),window.location.hash=""})},armRecombinateButton:function(){$("div#recombinate_button").on("click",function(){$("div#recombinate_button").addClass("disabled"),self.clearCurrentMeal(),setTimeout(function(){$("div#recombinator").html(""),self.recombinate(),self.displayMealDivs()},self.animationInterval_ingredients*(self.numberOfIngredients/2)),$(".share_item").hasClass("show-cards")&&($("div#share_button_text").html("SHARE THIS COMBO"),console.log("checking for class..."),$(".share_item").each(function(a){setTimeout(function(){document.getElementsByClassName("share_item")[2-a].classList.add("hide-cards"),document.getElementsByClassName("share_item")[2-a].classList.remove("show-cards")},200*(0.4*a))})),ga("send","event","Recombinator","recombinate")})},armShareButton:function(){$("div#share_button").on("click",function(){[].push(document.getElementsByClassName("share_item")),console.log("share clicked!"),$(".share_item").hasClass("show-cards")?($("div#share_button_text").html("SHARE THIS COMBO"),console.log("checking for class..."),$(".share_item").each(function(b){setTimeout(function(){document.getElementsByClassName("share_item")[1-b].classList.add("hide-cards"),document.getElementsByClassName("share_item")[1-b].classList.remove("show-cards")},200*(0.4*b))}),console.log("we're at the bottom...")):$(".share_item").each(function(b){$("div#share_button_text").html("<img src='/images/close_share_menu.png' />"),console.log("showing cards"),setTimeout(function(){document.getElementsByClassName("share_item")[b].classList.remove("hide-cards"),document.getElementsByClassName("share_item")[b].classList.add("show-cards")},200*(.5*b))}),$("div#twitter").on("click",function(){ga("send","event","Share","twitter"),console.log("twitter clicked")}),$("div#fb").on("click",function(){ga("send","event","Share","facebook")}),$("div#copy_group").on("click",function(){var b=document.getElementById("meal_url");if(document.selection){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(window.getSelection){var c=document.createRange();c.selectNodeContents(b),window.getSelection().removeAllRanges(),window.getSelection().addRange(c)}try{var d=document.execCommand("copy"),f=d?"successful":"unsuccessful";console.log("Copying text command was "+f),$("div#link_copied_modal").show().fadeOut(3e3)}catch(g){console.log("Unable to copy")}ga("send","event","Share","link_copied")})})},armSoundToggle:function(){$("div#sound_control").on("click",function(){if(!1==self.soundOn){self.soundOn=!0,$("div#sound_on").css("background-position","0px 100%"),$("div#sound_control").css("background-position","0px 0px");var a=document.getElementById("squish");a.load();var b=document.getElementById("bell");b.load(),ga("send","event","Sound","toggle_on")}else self.soundOn=!1,$("div#sound_on").css("background-position","0px 0px"),$("div#sound_control").css("background-position","-53px 0px"),ga("send","event","Sound","toggle_off");console.log("soundOn = "+self.soundOn)})},fetchIngredientsFromJSON:function(){},recombinate:function(){self.createMealModel(),self.createMealName(),self.createMealHash(),self.setSocialMediaLinks()},createMealHash:function(){var a="";self.meal.forEach(function(b){a+=b.hash}),$("div#meal_url").html("http://"+window.location.hostname+"/#"+a),console.log("hash = "+a),self.mealHash=a},createMealModel:function(){self.meal=[],self.mealName="",self.mealHash="",self.meal.push(self.pickRandomFromArray(self.exteriorArray)),self.numberOfIngredients=self.returnRandomWeightedItemFromArray(self.weightedArray_ingredientCountChances);var a,b,c=1;for(c;c<self.numberOfIngredients;c++)a=self.returnRandomWeightedItemFromArray(self.weightedArray_ingredientTypeChances),"sauce"===a?b=self.pickRandomFromArray(self.sauceArray):"exterior"===a?b=self.pickRandomFromArray(self.exteriorArray):"meat"===a?b=self.pickRandomFromArray(self.meatArray):"topping"===a?b=self.pickRandomFromArray(self.toppingArray):"filling"==a&&(b=self.pickRandomFromArray(self.fillingArray)),self.meal.push(b)},pickRandomFromArray:function(a){return a[Math.floor(Math.random()*a.length)]},returnRandomWeightedItemFromArray:function(a){var b=[],c=0;a.forEach(function(g){c+=g.chance,b.push(c)});for(var d=0,f=Math.random();d<b.length;){if(f<=b[d]){return a[d].item}d++}},createMealName:function(){var a="",b="",c="",d="",f=0,g=0,h=0,j="",k=/Taco Salad|Naked Chicken Chalupa|Locos|Chalupa|Gordita|Pizza|Taco|Tortilla|Tostada/;if("Tortilla"==self.meal[0].ingredient.match(k))j+="Burrito ";else if("Locos"==self.meal[0].ingredient.match(k)){var l=/Cool Ranch|Nacho Cheese|Fiery/;j+=self.meal[0].ingredient.match(l)+" Taco "}else j+=self.meal[0].ingredient.match(k)+" ";self.meal.forEach(function(m){if("meat"===m.type){var n=/Beef|Chicken|Sausage|Steak|Bacon/;b+=m.ingredient.match(n)+" ",h++}else if("topping"===m.type){var o=/Sour Cream/;m.ingredient.match(o)&&!d.match("Supreme")&&(d+="Supreme ");var p=/Guacamole/;m.ingredient.match(p)&&!b.match("Avocado")&&(b+="Avocado ");var q=/Cheese/;m.ingredient.match(q)&&(c+="Cheese ")}else if("filling"===m.type){var r=/Chili/;m.ingredient.match(r)&&(b+=m.ingredient.match(r)+" ");var s=/Eggs/;m.ingredient.match(s)&&!a.match("Breakfast")&&(a+="Breakfast ");var t=/Bean|Rice|Potato|Cheese/;m.ingredient.match(t)&&(c+=m.ingredient.match(t)+" ")}else if("sauce"===m.type){var u=/Nacho/;m.ingredient.match(u)&&!a.match("Nacho")&&(a+="Nacho ");var v=/Spicy|- Fire|- Hot|Diablo/;m.ingredient.match(v)&&(a+="Volcano ")}else"exterior"===m.type&&(f++,m.ingredient.match("Tortilla")&&g++)}),2==f&&(a+="Double Decker "),3==f&&(a+="Triple Decker "),3<f&&(a+="Xtreme Decker "),0==h&&(b+=c),2==g&&2==f&&c.match("Cheese")&&(j="Quesadilla",a.replace(/Double Decker/,"")),1==self.numberOfIngredients&&"Naked Chicken Chalupa "!=j&&(a+="Lite "),2==self.numberOfIngredients&&self.meal.forEach(function(m){m.ingredient.match("Lettuce")&&(a+="Veggie ")}),3<self.numberOfIngredients&&0==h&&""==c&&""==b&&"Lite "!=a&&1==f&&(a+="Loaded "),self.mealName+=a+b+j+d},setSocialMediaLinks:function(){var a=self.mealName.split(" ").slice(0,-1),b="";a.forEach(function(d,f,g){b+=d,f!==g.length-1&&(b+="%20")});var c="https://twitter.com/intent/tweet?text=Have%20you%20ever%20seen%20a%20"+b+"?&url=http%3A%2F%2Fwww."+location.hostname+"%2F%23"+self.mealHash+"&hashtags=recombinator,recombinate";$(".twitter-share-button").attr("href",c)},displayMealDivs:function(){var a,b,c,d,f,g=1;self.ingredientContainerIDs=[],self.meal.forEach(function(k,l){a="<div id='ingredient_picture"+l+"' class='ingredient_picture'><img class='ingredient_img' src="+k.address+"></div>",b="<div id='ingredient_label"+l+"' class='label'>"+k.ingredient+"<div class=\"line\"></div></div>",c="ingredient_container"+l,d="z-index:"+(g+=1),f="<div id="+c+" class='ingredient_container hidden' style="+d+"><div class='label_container'><div class='label_container2'>"+b+"</div></div><div class='picture_container'>"+a+"</div></div>",$("div#recombinator").prepend(f),self.ingredientContainerIDs.push(c)});var h=$(".ingredient_container").length,j=0;$("div#recombinator img").on("load",function(){j++,h==j&&self.animateMealDivs()})},clearCurrentMeal:function(){!0==self.soundOn&&crunch.play(),self.ingredientContainerIDs.forEach(function(a,b){var c=$("div#"+a),d=self.animationInterval_ingredients*(b/2.5);setTimeout(function(){c.addClass("clear")},d)})},animateMealDivs:function(){var a=$(window).height()-$("#buttons").height(),b=document.getElementById("squish"),c=[{start:0,length:0.43},{start:1.43,length:2.14},{start:3.14,length:4.13},{start:5.13,length:6.4},{start:7.4,length:8.92},{start:9.92,length:11.72},{start:12.72,length:14.8},{start:15.8,length:18.16},{start:19.16,length:21.8}];b.addEventListener("timeupdate",function(){console.log(this.currentTime),this.currentTime>=c[self.numberOfIngredients-1].length&&(this.pause(),console.log("Stopping squish..."))},!1),!0==self.soundOn&&(b.currentTime=c[self.numberOfIngredients-1].start,b.play()),self.ingredientContainerIDs.forEach(function(f,g){var h=$("div#"+f),j=self.animationInterval_ingredients*g;setTimeout(function(){h.addClass("drop")},j)}),self.displayNameBanner()},displayNameBanner:function(){var a=$("div#meal_title_banner");a.html("<div id='meal_title'>"+self.mealName+"</div>");var b=self.ingredientContainerIDs.length*self.animationInterval_ingredients+500,c=$("div#meal_title"),d=function(g){if(!0==self.soundOn){var h=document.getElementById("bell");h.play()}c.transition({width:"126%",opacity:"1",left:"-13%","font-size":"2.5em"},self.animationInterval_bannerText,function(){g()}),$("div#recombinate_button").removeClass("disabled")},f=function(){setTimeout(function(){c.transition({"font-size":"1.8em",width:"90%",left:"5%"},self.animationInterval_bannerText)},self.animationInterval_bannerTextExpandedPause)};setTimeout(function(){d(f)},b)}};app.init();